import math
import matplotlib.pyplot as plt
import numpy as np

# Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
#N_sec_BS = 3 # Ğ§Ğ¸ÑĞ»Ğ¾ ÑĞµĞºÑ‚Ğ¾Ñ€Ğ¾Ğ² Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ BS
#MCL = 0 # ĞŸĞ¾Ñ‚ĞµÑ€Ğ¸ Ğ½Ğ° Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğ»ÑƒÑ‡ĞµĞ²Ğ¾Ğµ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ° , Ğ´Ğ‘ 
#N_f = 0 # ĞŸĞ¾Ñ‚ĞµÑ€Ğ¸ Ğ½Ğ° ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ Ñ„Ğ¸Ğ´ĞµÑ€Ğ°Ğ¼Ğ¸ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°, Ğ´Ğ‘
#S_total = 10*10**6 # ĞŸĞ¾Ğ»Ğ¾ÑĞ° Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚, Ğ“Ñ†
#S_area = 100 # ĞŸĞ»Ğ¾Ñ‰Ğ°Ğ´ÑŒ Ñ‚ĞµÑ€Ñ€Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸, ĞºĞ².ĞºĞ¼
#S_building = 4 # ĞŸĞ»Ğ¾Ñ‰Ğ°Ğ´ÑŒ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ñ‹Ñ… Ğ¸ Ğ±Ğ¸Ğ·Ğ½ĞµÑ Ñ†ĞµĞ½Ñ‚Ñ€Ğ¾Ğ², ĞºĞ².Ğ¼

# ----------------------------------------------------------
# Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ:
# ----------------------------------------------------------

TX_BOW_BS = 46 # ĞœĞ¾Ñ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² BS, Ğ´Ğ‘Ğ¼
TX_POW_UE = 24 # ĞœĞ¾Ñ‰Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚Ñ‡Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğ° UE, Ğ´Ğ‘Ğ¼
AntGainBS = 21 # ĞšĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ ÑƒÑĞ¸Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ğ½Ñ‚ĞµĞ½Ğ½Ñ‹ BS, Ğ´Ğ‘Ğ¼
N_p = 15 # Ğ—Ğ°Ğ¿Ğ°Ñ Ğ¼Ğ¾Ñ‰Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ° Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ½Ğ¸ĞºĞ½Ğ¾Ğ²ĞµĞ½Ğ¸Ñ ÑĞºĞ²Ğ¾Ğ·ÑŒ ÑÑ‚ĞµĞ½Ñ‹, Ğ´Ğ‘
IM = 1 # Ğ—Ğ°Ğ¿Ğ°Ñ Ğ¼Ğ¾Ñ‰Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ° Ğ½Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ñ, Ğ´Ğ‘ 
Noise_f_bs = 2.4 # ĞšĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ ÑˆÑƒĞ¼Ğ° Ğ¿Ñ€Ğ¸ĞµĞ¼Ğ½Ğ¸ĞºĞ° BS, Ğ´Ğ‘ 
Noise_f_ue = 6 # ĞšĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ ÑˆÑƒĞ¼Ğ° Ğ¿Ñ€Ğ¸ĞµĞ¼Ğ½Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ, Ğ´Ğ‘ 
Feeder_Loss = 2 # Ğ´Ğ‘
SINR_DL = 2 # Ğ¢Ñ€ĞµĞ±ÑƒĞµĞ¼Ğ¾Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ SINR Ğ´Ğ»Ñ DL, Ğ´Ğ‘
SINR_UL = 4 # Ğ¢Ñ€ĞµĞ±ÑƒĞµĞ¼Ğ¾Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ SINR Ğ´Ğ»Ñ UL, Ğ´Ğ‘
MIMO_Gain = 3*2 # Ğ§Ğ¸ÑĞ»Ğ¾ Ğ¿Ñ€Ğ¸ĞµĞ¼Ğ¾-Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‰Ğ¸Ñ… Ğ°Ğ½Ñ‚ĞµĞ½Ğ½ Ğ½Ğ° BS 
f = 1.8 # Ğ”Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚, Ğ“Ğ“Ñ†
hBS = 50 # Ğ’Ñ‹ÑĞ¾Ñ‚Ğ° Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸, Ğ¼ 
hUE = 3 # Ğ’Ñ‹ÑĞ¾Ñ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğ°, Ğ¼ 
BW_UL = 10*10**6 # ĞŸĞ¾Ğ»Ğ¾ÑĞ° Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚ Ğ² UL, Ğ“Ñ† 
BW_DL = 20*10**6 # ĞŸĞ¾Ğ»Ğ¾ÑĞ° Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚ Ğ² DL, Ğ“Ñ† 
duplex = 'FDD' # Ğ”ÑƒĞ¿Ğ»ĞµĞºÑ UL Ğ¸ DL

# --------------------------------------------------------
# Ğ Ğ°ÑÑ‡ĞµÑ‚ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ° Ğ²Ğ¾ÑÑ…Ğ¾Ğ´ÑÑ‰ĞµĞ³Ğ¾ ĞºĞ°Ğ½Ğ°Ğ»Ğ°:
# --------------------------------------------------------

# TxPowerUE-FeederLoss+AntGainBS+MIMOGain-PL(d)-IM-Penetration>=RxSensBS 
# RxSens = ğ‘ğ‘œğ‘–ğ‘ ğ‘’ğ¹ğ‘–ğ‘”ğ‘¢ğ‘Ÿğ‘’ + ğ‘‡â„ğ‘’ğ‘Ÿğ‘šğ‘ğ‘™ğ‘ğ‘œğ‘–ğ‘ ğ‘’ + ğ‘…ğ‘’ğ‘ğ‘–ğ‘Ÿğ‘’ğ‘‘ğ‘†ğ¼ğ‘ğ‘…, (2.17)
ThermalNoise_UL = -174 + 10 * math.log10(BW_UL) # (2.18)
RxSens_bs = Noise_f_bs + ThermalNoise_UL + SINR_UL # (2.17)
MAPL_UL = (RxSens_bs - TX_POW_UE + Feeder_Loss - AntGainBS - MIMO_Gain + IM + N_p) * (-1)
print('budjet voshodyashego', MAPL_UL ,'dB')

# --------------------------------------------------------
# Ğ Ğ°ÑÑ‡ĞµÑ‚ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ° Ğ½Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰ĞµĞ³Ğ¾ ĞºĞ°Ğ½Ğ°Ğ»Ğ°:
# --------------------------------------------------------

# TxPowerBS âˆ’ ğ¹ğ‘’ğ‘’ğ‘‘ğ‘’ğ‘Ÿğ¿ğ‘œğ‘ ğ‘  + AntGainBS + MIMOGain âˆ’ MAPL_DL âˆ’ IM âˆ’ PenetrationM = RxSensUE. (2.19)
# RxSens = ğ‘ğ‘œğ‘–ğ‘ ğ‘’ğ¹ğ‘–ğ‘”ğ‘¢ğ‘Ÿğ‘’ + ğ‘‡â„ğ‘’ğ‘Ÿğ‘šğ‘ğ‘™ğ‘ğ‘œğ‘–ğ‘ ğ‘’ + ğ‘…ğ‘’ğ‘ğ‘–ğ‘Ÿğ‘’ğ‘‘ğ‘†ğ¼ğ‘ğ‘…, (2.17)
ThermalNoise_DL = -174 + 10 * math.log10(BW_DL) # (2.18)
RxSens_ue = Noise_f_ue+ThermalNoise_DL+SINR_DL
MAPL_DL = (-RxSens_ue + TX_BOW_BS - Feeder_Loss + AntGainBS + MIMO_Gain - IM - N_p) 
print('bugjet nishodyashego', MAPL_DL ,'dB')

# --------------------------------------------------------
# UMiNLOS
# --------------------------------------------------------

# ğ‘ƒğ¿Ğ´Ğ‘ = 20ğ‘™ğ‘œğ‘”10 (4ğœ‹ğ‘‘/ğœ†) = 20ğ‘™ğ‘œğ‘”10 (4ğœ‹ğ‘‘ğ‘“/ğ‘) (2.2) Ğ´Ğ»Ñ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚Ğ²Ğ°
# Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° Ğ·Ğ°Ñ‚ÑƒÑ…Ğ°Ğ½Ğ¸Ğ¹ UMiNLOS Ğ¸Ğ¼ĞµĞµÑ‚ Ğ²Ğ¸Ğ´ (2.3): ğ‘ƒğ¿(ğ‘‘) = 26 âˆ™ ğ‘™ğ‘œğ‘”10(f[Ğ“Ğ“Ñ†]) + 22.7 + 36.7 âˆ™ ğ‘™ğ‘œğ‘”10(d[Ğ¼]), (2.3)
d = np.arange(1, 3000) # Ğ¼ 
PL_UM = 26 * np.log10(f)+ 22.7 + 36.7 * np.log10(d)
intersection = np.intersect1d(MAPL_UL, MAPL_DL)
Sum_UM = round(4000**2 / (1.95 * 574**2))
print('UMiNLOS R (UL)=', 574 ,'m')
print('UMiNLOS R (DL)=', 1710 ,'m')
print('UMiNLOS kol-vo bazovyh stansiy: ', Sum_UM)

#distance = d[np.where(PL_UM == intersection)]
#print('Ğ Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ´Ğ¾ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ¿ĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ñ:', distance[0], 'Ğ¼')

# --------------------------------------------------------
# COST231
# --------------------------------------------------------

# Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ° Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° Ğ·Ğ°Ñ‚ÑƒÑ…Ğ°Ğ½Ğ¸Ğ¹ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ²Ğ¸Ğ´ (2.14): ğ‘ƒğ¿(ğ‘‘) = ğ´ + ğµ âˆ™ ğ‘™ğ‘œğ‘”10(ğ‘“) âˆ’ 13.82 âˆ™ ğ‘™ğ‘œğ‘”10(â„ğµğ‘†) âˆ’ ğ‘ + ğ‘  âˆ™ ğ‘™ğ‘œğ‘”10(ğ‘‘) + ğ¿ğ‘ğ‘™ğ‘¢ğ‘¡ğ‘¡ğ‘’
# a = 3.2 âˆ™ [ğ‘™ğ‘œğ‘”10(11.75 âˆ™ â„ğ‘šğ‘ )]2 âˆ’ 4.97 Ğ´Ğ»Ñ ğ·ğ‘ˆ(Ğ¿Ğ»Ğ¾Ñ‚Ğ½Ğ°Ñ Ğ³Ğ¾Ñ€Ğ¾Ğ´ÑĞºĞ°Ñ Ğ·Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°) Ğ¸ U(Ğ³Ğ¾Ñ€Ğ¾Ğ´)
# a = [1.1 âˆ™ ğ‘™ğ‘œğ‘”10(ğ‘“)] âˆ™ â„ğ‘šğ‘  âˆ’ [1.56 âˆ™ ğ‘™ğ‘œğ‘”10(ğ‘“) âˆ’ 0.8] Ğ´Ğ»Ñ ğ‘†ğ‘ˆ (Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ñ€Ğ¾Ğ´), ğ‘…ğ‘ˆğ‘…ğ´ğ¿ (ÑĞµĞ»ÑŒÑĞºĞ°Ñ Ğ¼ĞµÑÑ‚Ğ½Ğ¾ÑÑ‚ÑŒ), ğ‘…ğ‘‚ğ´D(Ñ‚Ñ€Ğ°ÑÑĞ°)
# s = 44.9 âˆ’ 6.55 âˆ™ ğ‘™ğ‘œğ‘”10(ğ‘“), Ğ´Ğ»Ñ ğ‘‘ â‰¥ 1 ĞºĞ¼ ---- Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ hBS

hms = 5 # Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² ; hms Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ğ°Ğ½Ñ‚ĞµĞ½Ğ½ Ğ¾Ñ‚ 1 Ğ´Ğ¾Ğ¼ 10 Ğ¼
a_U = 3.2 * np.log10(11.75 * hms) * 2 - 4.97 # Ğ´Ğ»Ñ DU U 
a_R = (1.1 * np.log10(f)) * hms * (1.56 * np.log10(f) - 0.8) # Ğ´Ğ»Ñ SU, RURAL, ROAD
Lclutter_SU = - (2 * (np.log10(f/28))**2 + 5.4)
s = 44.9 - 6.55 * np.log10(f) 
hBS = 50 # Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² ; hbs Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ²ĞµÑĞ° Ğ°Ğ½Ñ‚ĞµĞ½Ğ½Ñ‹ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚ 30 Ğ´Ğ¾ 200 Ğ¼ 
PL_CO = 69.55 + 26.16 * np.log10(f) - 13.8 * np.log10(hBS) - a_R + s * np.log10(d) + Lclutter_SU
PL_COST = 69.55 + 26.16 * np.log(f) - 13.82 * np.log(hBS) + (44.9 - 6.55 * np.log(hBS)*(np.log(d))) * (-1)
Sum_CO = round(100000**2 / (1.95 * 295**2))
print('COST231 R (UL) =', 295 ,'m')
print('COST231 R (DL) =', 742 ,'m')
print('COST231 kol-vo bazovyh snatsyi: ', Sum_CO)

# --------------------------------------------------------
# Walfish-Ikegami
# --------------------------------------------------------

# ğ¿ğ¿ğ‘‚ğ‘† = 42.6 + 20ğ‘™ğ‘œğ‘”10(ğ‘“) + 26ğ‘™ğ‘œğ‘”10(ğ‘‘). (2.8) - Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

Walfish = 42.6 + 20 * np.log10(f) + 26 * np.log10(d) # ĞŸÑ€Ğ¸ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
Walfish_L = 33.44 + 20 * np.log10(f) + 20 * np.log10(d) # ĞŸÑ€Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğ¸ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸


plt.figure(figsize=(10, 6))
plt.plot(d, PL_UM, label='Path Loss UMiNLOS(PL_UM)')
plt.plot(d, PL_CO, label='Path Loss COST231(PL_CO)')
plt.plot(d, PL_COST, label='Path Loss COST(PL_COST)')
plt.plot(d, Walfish, label='Walfish-Ikegami Pryamaya v(Walfish)')
plt.plot(d, Walfish_L, label='Walfish-Ikegami Otsutstvie v(Walfish_L)')
plt.axhline(y=MAPL_UL, color='r', linestyle='--', label='MAPL_UL')
plt.axhline(y=MAPL_DL, color='g', linestyle='--', label='MAPL_DL')
plt.xlabel('Distance (m)')
plt.ylabel('Path Loss (dB)')
plt.title('Path Loss vs. Distance')
plt.legend()
plt.grid(True)
plt.show()